<!DOCTYPE html>
<html>
<head>
    <title>ESP32 Doorbell Setup</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/style.css">
    <script>
        function connectWiFi() {
            // Save WiFi credentials to NVS and reboot.
            let ssid = document.getElementById("ssid").value;
            let password = document.getElementById("password").value;

            if (ssid === "") {
                alert("âš ï¸ Please select or enter an SSID!");
                return;
            }

            fetch("/saveWiFi", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ "ssid": ssid, "password": password })
            }).then(response => response.text())
              .then(text => {
                  alert(text + "\nESP32 will restart now.");
                  setTimeout(() => location.reload(), 3000);
              })
              .catch(error => {
                  alert("Error saving WiFi credentials: " + error);
              });
        }

        function saveTr064() {
            // Save TR-064 credentials and ring number for FRITZ!Box.
            let tr064_user = document.getElementById("tr064_user").value;
            let tr064_pass = document.getElementById("tr064_pass").value;
            let number = document.getElementById("tr_number").value;

            fetch("/saveTR064", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ 
                    "tr064_user": tr064_user, 
                    "tr064_pass": tr064_pass, 
                    "number": number 
                })
            }).then(response => response.text())
              .then(text => {
                  alert(text);
              })
              .catch(error => {
                  alert("Error saving TR-064 settings: " + error);
              });
        }
        function rescanWiFi() {
            fetch("/scanWifi")
                .then(response => response.text())
                .then(text => {
                    alert(text + "\nRefresh the page in a few seconds.");
                })
                .catch(error => {
                    alert("Error starting WiFi scan: " + error);
                });
        }
    </script>
</head>
<body>
    <div class="wifi-setup-container">
        <h1>ðŸ”” ESP32 Doorbell Wi-Fi Setup</h1>
        <p>Configure your doorbell's WiFi connection</p>
        
        <label><strong>Select Network:</strong></label>
        <select id="ssid">
            <option value="">-- Select WiFi Network --</option>
            {{SSID_OPTIONS}}
        </select>
        
        <label><strong>Or Enter SSID Manually:</strong></label>
        <input type="text" id="manual_ssid" placeholder="Enter SSID (if hidden)">
        <script>
            document.getElementById("manual_ssid").addEventListener("input", function() {
                document.getElementById("ssid").value = this.value;
            });
        </script>
        
        <label><strong>Password:</strong></label>
        <input type="password" id="password" placeholder="Enter Wi-Fi Password">
        
        <button class="button btn-save" title="Save WiFi credentials and reboot into STA mode." onclick="connectWiFi()">ðŸ’¾ Save & Connect</button>
        <button class="button btn-info" title="Refresh the list of available WiFi networks." onclick="rescanWiFi()">ðŸ”„ Rescan WiFi</button>

        <hr>

        <h3 class="card-title">FRITZ!Box TR-064</h3>
        <label><strong>TR-064 Username:</strong></label>
        <input type="text" id="tr064_user" placeholder="TR-064 username">

        <label><strong>TR-064 Password:</strong></label>
        <input type="password" id="tr064_pass" placeholder="TR-064 password">

        <label><strong>Internal Ring Number:</strong></label>
        <input type="text" id="tr_number" placeholder="e.g., **9 or **610">

        <button class="button btn-save" title="Save TR-064 credentials and ring number." onclick="saveTr064()">ðŸ’¾ Save TR-064 Settings</button>
        
        <footer>
            <p class="disclaimer">ESP32-S3 HomeKit Doorbell</p>
        </footer>
    </div>
</body>
</html>
